<p>
  <span class = "app-primary-color">
  <i class="material-icons">info</i>
  </span>

  <span *ngIf="isMetadataReport()">
  Shows submitted {{ ReportTypeUtils.getPluralName(reportType) }} and their release statuses. Search by accession or unique name, or simply click search to show most recent submissions. The results will show the most recently submitted {{ReportTypeUtils.getPluralName(reportType)}}
  in your submission account.
  </span>

  <span *ngIf="isFileReport()">
  Shows submitted {{ ReportTypeUtils.getPluralName(reportType) }} and their archival statuses. Search by accession or other conditions, or simply click search to show most recent submissions. The results will show the most recently submitted {{ReportTypeUtils.getPluralName(reportType)}}
  in your submission account.
  </span>

  <span *ngIf="isProcessReport()">
  Shows the {{ ReportTypeUtils.getPluralName(reportType) }}. Search by accession or other conditions, or simply click search to show most recent submissions. The results will show the {{ReportTypeUtils.getPluralName(reportType)}} in your submission account.
  </span>

  <span *ngIf="reportType == ReportType.runProcess">
  </span>

  <span *ngIf="reportType == ReportType.analysisProcess">
  The primary use of this report is to retrieve sequence accessions assigned as part of
  genome assembly, transcriptome assembly or sequence flat file submissions.
  </span>

  <span *ngIf="reportType == ReportType.unsubmittedFiles">
  Shows uploaded files scheduled to be removed unless submitted by the expiration date.
  Uploaded files will only be included into the archive once they have been
  submitted either as runs or analyses. <b>Note that unlike all other reports, the
  contents of this report may not be fully up to date. This report
  is refreshed at most once per day.</b>
  </span>

</p>

<p><b>Please click search to see the results.</b></p>

<mat-form-field *ngIf="!isMetadataReport() && reportType != ReportType.unsubmittedFiles">
    <input matInput placeholder="Accession" [(ngModel)]="id">
</mat-form-field>

<mat-form-field *ngIf="isMetadataReport() && reportType != ReportType.unsubmittedFiles">
  <input matInput placeholder="Accession or Name" [(ngModel)]="id">
</mat-form-field>

<span *ngIf="isMetadataReport()">
or
  <mat-form-field>
    <mat-select placeholder="Release status" [(ngModel)]="status">
      <mat-option value="private">
        Private
      </mat-option>
      <mat-option value="cancelled">
        Cancelled
      </mat-option>
      <mat-option value="public">
        Public
      </mat-option>
      <mat-option value="suppressed">
        Suppressed
      </mat-option>
      <mat-option value="killed">
        Killed
      </mat-option>
      <mat-option value="temporarily suppressed">
        Temporarily suppressed
      </mat-option>
      <mat-option value="temporarily killed">
        Temporarily killed
      </mat-option>
    </mat-select>
  </mat-form-field>
</span>

<span *ngIf="reportType == ReportType.analyses || reportType == ReportType.analysisFiles || reportType == ReportType.analysisProcess">
  or
  <mat-form-field>
    <mat-select placeholder="Analysis type" [(ngModel)]="analysisType">
      <mat-option value="SEQUENCE_ASSEMBLY">
        Genome assembly
      </mat-option>
      <mat-option value="TRANSCRIPTOME_ASSEMBLY">
        Transcriptome assembly
      </mat-option>
      <mat-option value="PATHOGEN_ANALYSIS">
        Pathogen analysis
      </mat-option>
      <mat-option value="AMR_ANTIBIOGRAM">
        AMR Antibiogram
      </mat-option>
      <mat-option value="SEQUENCE_ANNOTATION">
        Sequence annotation
      </mat-option>
      <mat-option value="SEQUENCE_VARIATION">
        Sequence variation
      </mat-option>
      <mat-option value="REFERENCE_ALIGNMENT">
        Reference alignment
      </mat-option>
      <mat-option value="REFERENCE_SEQUENCE">
        Reference sequence
      </mat-option>
      <mat-option value="PROCESSED_READS">
        Processed reads
      </mat-option>
      <mat-option value="SEQUENCE_FLATFILE">
        Sequence flatfile
      </mat-option>
    </mat-select>
  </mat-form-field>
</span>

<span *ngIf="isFileReport()">
  or
  <mat-form-field>
    <mat-select placeholder="Archive status" [(ngModel)]="processStatus">
      <mat-option value="active">
        active
      </mat-option>
      <mat-option value="completed">
        completed
      </mat-option>
      <mat-option value="failed">
        failed
      </mat-option>
    </mat-select>
  </mat-form-field>
</span>

<span *ngIf="isProcessReport()">
  or
  <mat-form-field>
    <mat-select placeholder="Process status" [(ngModel)]="processStatus">
      <mat-option value="active">
        active
      </mat-option>
      <mat-option value="completed">
        completed
      </mat-option>
      <mat-option value="failed">
        failed
      </mat-option>
    </mat-select>
  </mat-form-field>
</span>


<button mat-raised-button color="accent" (click)="report()" [disabled]="active">
  Search
</button>

<button mat-raised-button (click)="reset()">Reset</button>

<mat-form-field>
  <mat-select placeholder="Maximum rows" [(ngModel)]="rows">
    <mat-option value="100">
      100
    </mat-option>
    <mat-option value="500">
      500
    </mat-option>
    <mat-option value="1000">
      1000
    </mat-option>
    <mat-option value="5000">
      5000
    </mat-option>
  </mat-select>
</mat-form-field>

<mat-checkbox [(ngModel)]="showAlias" *ngIf="isMetadataReport()">
  Show unique name
</mat-checkbox>

<span *ngIf="this.data && this.data.length > 0">
  <a href="{{ csvDownloadAllLink() }}">Download all results</a>
</span>

<div *ngIf="active" style="height:70px;">
    <mat-spinner [diameter]="50" [strokeWidth]="5" style="margin:0 auto;">
    </mat-spinner>
</div>

<div *ngIf="dataSource !== undefined">

  <mat-table [dataSource]="dataSource">
      <ng-container *ngFor="let col of displayedColumns" matColumnDef={{col}}>
  	    <mat-header-cell *matHeaderCellDef>{{ col }}</mat-header-cell>
        <div *ngIf="col!='Action' && col!='Archive status' && col!='Process status'">
  	         <mat-cell *matCellDef="let element">{{getElementValue(element, col)}}</mat-cell>
        </div>

        <span *ngIf="col=='Archive status'">

          <mat-cell *matCellDef="let element">
            <span *ngIf="getElementValue(element, col)=='File archived'">
              <span class="action-completed"
                    matTooltip="The file has been included in the permanent archive.">{{getElementValue(element, col)}}</span>
            </span>
            <span *ngIf="getElementValue(element, col)=='Processing file' || getElementValue(element, col)=='File submitted'">
              <span class="action-active"
              matTooltip="The file is waiting to be included in the permanent archive.">{{getElementValue(element, col)}}</span>
            </span>
            <span *ngIf="getElementValue(element, col)!='File archived' && getElementValue(element, col)!='Processing file' && getElementValue(element, col)!='File submitted'">
              <span class="action-failed"
              matTooltip="The file has failed to be included in the permanent archived.">{{getElementValue(element, col)}}</span>
            </span>
          </mat-cell>

        </span>

        <span *ngIf="col=='Process status'">

          <mat-cell *matCellDef="let element">

            <span *ngIf="getElementValue(element, col)=='COMPLETED' || getElementValue(element, col)=='CANCELLED'">
              <span class="action-completed"
                   matTooltip="The post-archival processing of the file has finished.">{{getElementValue(element, col)}}</span>
            </span>
            <span *ngIf="getElementValue(element, col)=='FAILED'">
              <span class="action-failed"
                   matTooltip="The post-archival processing of the file has failed.">{{getElementValue(element, col)}}</span>
            </span>
            <span *ngIf="getElementValue(element, col)!='COMPLETED' && getElementValue(element, col)!='CANCELLED' && getElementValue(element, col)!='FAILED'">
              <span class="action-active"
                   matTooltip="The post-archival processing of the file is ongoing.">{{getElementValue(element, col)}}</span>
            </span>

          </mat-cell>

        </span>


        <div *ngIf="col=='Action'">

          <mat-cell *matCellDef="let element">

            <app-report-action [actions]="getActions(element)" (onAction)="action($event)">
            </app-report-action>

          </mat-cell>

        </div>

      </ng-container>

      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row> <!-- (click)="clickRow(row)" -->

  </mat-table>

</div>

<div [hidden]="dataSource == undefined">
  <!-- the paginator must be created before the dataSource has been defined -->
  <mat-paginator #dataPaginator
                 [pageSize]="10"
                 [pageSizeOptions]="[10, 25, 50]">
  </mat-paginator>

</div>

<div *ngIf="dataError !== undefined">
  <div class="app-error">
      <i class="material-icons">error</i>
      {{dataError}}
  </div>
</div>
